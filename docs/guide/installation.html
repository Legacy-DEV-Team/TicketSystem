<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Installation - Ticket System Documentation</title>
    <meta name="description" content="Installation guide for Ticket System - Professional Discord ticket management system">
    <link rel="stylesheet" href="../assets/styles.css">
    <link rel="icon" href="../public/icon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header Placeholder -->
    <div id="header-placeholder"></div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <div class="docs-layout">
                <!-- Sidebar -->
                <aside class="docs-sidebar">
                    <nav class="docs-nav-menu">
                        <div class="nav-section">
                            <h4>Getting Started</h4>
                            <ul>
                                <li><a href="getting-started.html" class="nav-item">Introduction</a></li>
                                <li><a href="installation.html" class="nav-item active">Installation</a></li>
                                <li><a href="configuration.html" class="nav-item">Configuration</a></li>
                                <li><a href="first-setup.html" class="nav-item">First Setup</a></li>
                            </ul>
                        </div>
                        <div class="nav-section">
                            <h4>Bot Configuration</h4>
                            <ul>
                                <li><a href="bot-setup.html" class="nav-item">Discord Bot Setup</a></li>
                                <li><a href="permissions.html" class="nav-item">Permissions & Roles</a></li>
                                <li><a href="categories.html" class="nav-item">Ticket Categories</a></li>
                                <li><a href="auto-close.html" class="nav-item">Auto-Close System</a></li>
                            </ul>
                        </div>
                        <div class="nav-section">
                            <h4>Web Panel</h4>
                            <ul>
                                <li><a href="dashboard.html" class="nav-item">Dashboard Overview</a></li>
                                <li><a href="user-management.html" class="nav-item">User Management</a></li>
                                <li><a href="analytics.html" class="nav-item">Analytics & Reports</a></li>
                                <li><a href="custom-domains.html" class="nav-item">Custom Domains</a></li>
                            </ul>
                        </div>
                    </nav>
                </aside>

                <!-- Content -->
                <div class="docs-content">
                    <article class="docs-article">
                        <header class="article-header">
                            <h1>Installation</h1>
                            <p class="article-description">Complete installation guide for self-hosting Ticket System</p>
                        </header>

                        <section id="system-requirements">
                            <h2>System Requirements</h2>
                            
                            <h3>Minimum Requirements</h3>
                            <ul>
                                <li><strong>Node.js</strong>: 18.0.0 or higher</li>
                                <li><strong>Memory</strong>: 512MB RAM minimum, 2GB recommended</li>
                                <li><strong>Storage</strong>: 1GB available space</li>
                                <li><strong>Database</strong>: MongoDB 5.0+ or MongoDB Atlas</li>
                                <li><strong>Cache</strong>: Redis 6.0+ or Redis Cloud</li>
                                <li><strong>OS</strong>: Linux, macOS, or Windows with WSL2</li>
                            </ul>

                            <h3>Recommended Production Setup</h3>
                            <ul>
                                <li><strong>CPU</strong>: 2 vCPUs</li>
                                <li><strong>Memory</strong>: 4GB RAM</li>
                                <li><strong>Storage</strong>: 10GB SSD</li>
                                <li><strong>Network</strong>: 1Gbps connection</li>
                                <li><strong>Load Balancer</strong>: NGINX or Cloudflare</li>
                                <li><strong>SSL</strong>: Let's Encrypt or commercial certificate</li>
                            </ul>
                        </section>

                        <section id="prerequisites">
                            <h2>Prerequisites</h2>
                            <p>Before installation, ensure you have:</p>
                            
                            <h3>1. Node.js and npm</h3>
                            <div class="code-block">
                                <pre><code># Install Node.js (using NodeSource repository)
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs
   
# Verify installation
node --version  # Should be 18.0.0+
npm --version</code></pre>
                            </div>

                            <h3>2. MongoDB</h3>
                            <div class="code-block">
                                <pre><code># Local MongoDB installation (Ubuntu/Debian)
wget -qO - https://www.mongodb.org/static/pgp/server-6.0.asc | sudo apt-key add -
echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/6.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-6.0.list
sudo apt-get update
sudo apt-get install -y mongodb-org
sudo systemctl start mongod
sudo systemctl enable mongod</code></pre>
                            </div>

                            <h3>3. Redis</h3>
                            <div class="code-block">
                                <pre><code># Local Redis installation
sudo apt-get install redis-server
sudo systemctl start redis-server
sudo systemctl enable redis-server</code></pre>
                            </div>

                            <h3>4. Git</h3>
                            <div class="code-block">
                                <pre><code>sudo apt-get install git</code></pre>
                            </div>
                        </section>

                        <section id="installation-methods">
                            <h2>Installation Methods</h2>
                            
                            <h3>Method 1: Direct Installation</h3>
                            
                            <h4>1. Clone the Repository</h4>
                            <div class="code-block">
                                <pre><code># Clone the repository
git clone https://github.com/Legacy-DEV-Team/TicketSystem.git
cd TicketSystem

# Check out the latest stable release
git checkout tags/v1.0.0</code></pre>
                            </div>

                            <h4>2. Install Dependencies</h4>
                            <div class="code-block">
                                <pre><code># Install dependencies for all packages
npm install

# If using pnpm (recommended for development)
npm install -g pnpm
pnpm install</code></pre>
                            </div>

                            <h4>3. Environment Configuration</h4>
                            <div class="code-block">
                                <pre><code># Copy environment templates
cp .env.example .env
cp packages/bot/.env.example packages/bot/.env
cp packages/web/.env.example packages/web/.env</code></pre>
                            </div>

                            <p>Edit the <code>.env</code> files with your configuration:</p>
                            <div class="code-block">
                                <pre><code># Root .env
NODE_ENV=production
LOG_LEVEL=info

# MongoDB Configuration
MONGODB_URI=mongodb://localhost:27017/ticket-system
# or for MongoDB Atlas:
# MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/ticket-system

# Redis Configuration
REDIS_URL=redis://localhost:6379
# or for Redis Cloud:
# REDIS_URL=redis://username:password@host:port

# Bot Configuration (packages/bot/.env)
BOT_WEBHOOK_PORT=3001

# Web Configuration (packages/web/.env)
NEXTAUTH_URL=https://yourdomain.com
NEXTAUTH_SECRET=your-nextauth-secret-here
BOT_WEBHOOK_URL=http://localhost:3001</code></pre>
                            </div>

                            <h4>4. Build the Application</h4>
                            <div class="code-block">
                                <pre><code># Build all packages
npm run build

# Or build individually
npm run build:shared
npm run build:bot
npm run build:web</code></pre>
                            </div>

                            <h4>5. Database Setup</h4>
                            <div class="code-block">
                                <pre><code># Start MongoDB (if local)
sudo systemctl start mongod

# Start Redis (if local)
sudo systemctl start redis-server

# The application will automatically create collections and indexes on first run</code></pre>
                            </div>

                            <h3>Method 2: Docker Installation</h3>
                            
                            <h4>Using Docker Compose (Recommended)</h4>
                            <div class="code-block">
                                <pre><code># Clone the repository
git clone https://github.com/Legacy-DEV-Team/TicketSystem.git
cd TicketSystem

# Copy and edit environment file
cp docker-compose.env.example docker-compose.env
# Edit docker-compose.env with your configuration

# Start all services
docker-compose up -d

# View logs
docker-compose logs -f

# Stop services
docker-compose down</code></pre>
                            </div>
                        </section>

                        <section id="process-management">
                            <h2>Process Management</h2>
                            
                            <h3>Using PM2 (Recommended for Production)</h3>
                            <div class="code-block">
                                <pre><code># Install PM2 globally
npm install -g pm2

# Create PM2 ecosystem file
cat > ecosystem.config.js << 'EOF'
module.exports = {
  apps: [
    {
      name: 'discord-ticket-bot',
      script: 'packages/bot/dist/index.js',
      cwd: process.cwd(),
      instances: 1,
      exec_mode: 'fork',
      env: {
        NODE_ENV: 'production'
      },
      error_file: './logs/bot-error.log',
      out_file: './logs/bot-out.log',
      log_file: './logs/bot-combined.log',
      time: true
    },
    {
      name: 'discord-ticket-web',
      script: 'packages/web/server.js',
      cwd: process.cwd(),
      instances: 'max',
      exec_mode: 'cluster',
      env: {
        NODE_ENV: 'production',
        PORT: 3000
      },
      error_file: './logs/web-error.log',
      out_file: './logs/web-out.log',
      log_file: './logs/web-combined.log',
      time: true
    }
  ]
};
EOF

# Create logs directory
mkdir -p logs

# Start applications
pm2 start ecosystem.config.js

# Save PM2 configuration
pm2 save

# Setup PM2 startup script
pm2 startup
# Follow the instructions provided by the command

# Monitor applications
pm2 monit

# View logs
pm2 logs

# Restart applications
pm2 restart all

# Stop applications
pm2 stop all</code></pre>
                            </div>
                        </section>

                        <section id="web-server-configuration">
                            <h2>Web Server Configuration</h2>
                            
                            <h3>NGINX Configuration</h3>
                            <div class="code-block">
                                <pre><code># /etc/nginx/sites-available/ticket-system
server {
    listen 80;
    server_name yourdomain.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name yourdomain.com;

    # SSL Configuration
    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;

    # Security Headers
    add_header X-Frame-Options DENY;
    add_header X-Content-Type-Options nosniff;
    add_header X-XSS-Protection "1; mode=block";
    add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload";

    # Main application
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    # Bot webhook endpoint
    location /webhook/ {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Static files
    location /transcripts/ {
        alias /opt/ticket-system/transcripts/;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}

# Enable the site
sudo ln -s /etc/nginx/sites-available/ticket-system /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx</code></pre>
                            </div>

                            <h3>SSL Certificate (Let's Encrypt)</h3>
                            <div class="code-block">
                                <pre><code># Install Certbot
sudo apt-get install certbot python3-certbot-nginx

# Obtain certificate
sudo certbot --nginx -d yourdomain.com

# Auto-renewal (already configured, but verify)
sudo crontab -l | grep certbot
# Should show: 0 12 * * * /usr/bin/certbot renew --quiet</code></pre>
                            </div>
                        </section>

                        <section id="post-installation">
                            <h2>Post-Installation</h2>
                            
                            <h3>1. Verify Installation</h3>
                            <div class="code-block">
                                <pre><code># Check if services are running
pm2 status
# or
sudo systemctl status discord-ticket-bot discord-ticket-web

# Check database connections
mongosh --eval "db.runCommand({ping:1})"
redis-cli ping

# Check web access
curl -I https://yourdomain.com</code></pre>
                            </div>

                            <h3>2. Initial Configuration</h3>
                            <ol>
                                <li>Access the admin panel: <code>https://yourdomain.com/admin</code></li>
                                <li>Configure system settings (Discord bot tokens, payment providers)</li>
                                <li>Test bot functionality in a Discord server</li>
                            </ol>

                            <h3>3. Monitoring Setup</h3>
                            <div class="code-block">
                                <pre><code># Install monitoring tools
npm install -g @ticket-system/monitoring

# Setup health checks
cat > /opt/ticket-system/health-check.sh << 'EOF'
#!/bin/bash
curl -f http://localhost:3000/api/health || exit 1
curl -f http://localhost:3001/health || exit 1
EOF

chmod +x /opt/ticket-system/health-check.sh

# Add to crontab for monitoring
echo "*/5 * * * * /opt/ticket-system/health-check.sh" | crontab -</code></pre>
                            </div>
                        </section>

                        <section id="troubleshooting">
                            <h2>Troubleshooting</h2>
                            
                            <h3>Common Issues</h3>
                            <ol>
                                <li><strong>Port conflicts</strong>: Ensure ports 3000 and 3001 are available</li>
                                <li><strong>Database connection</strong>: Verify MongoDB and Redis are running</li>
                                <li><strong>Permissions</strong>: Ensure the application user has read/write access to files</li>
                                <li><strong>Firewall</strong>: Open necessary ports (80, 443, 3000, 3001)</li>
                            </ol>

                            <h3>Log Locations</h3>
                            <ul>
                                <li><strong>PM2 logs</strong>: <code>~/.pm2/logs/</code></li>
                                <li><strong>Systemd logs</strong>: <code>journalctl -u service-name</code></li>
                                <li><strong>Application logs</strong>: <code>logs/</code> directory in project root</li>
                                <li><strong>NGINX logs</strong>: <code>/var/log/nginx/</code></li>
                            </ul>
                        </section>

                        <section id="next-steps">
                            <h2>Next Steps</h2>
                            <p>After successful installation:</p>
                            <ol>
                                <li><strong><a href="configuration.html">Configure the system</a></strong> - Set up Discord bot and payment providers</li>
                                <li><strong><a href="dashboard.html">Set up monitoring</a></strong> - Configure alerts and health checks</li>
                                <li><strong><a href="security.html">Security hardening</a></strong> - Additional security measures</li>
                                <li><strong><a href="backup.html">Backup strategy</a></strong> - Data protection and recovery</li>
                            </ol>
                        </section>
                    </article>

                    <!-- Table of Contents -->
                    <aside class="table-of-contents">
                        <h4>On this page</h4>
                        <!-- Auto-generated by JavaScript -->
                    </aside>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer Placeholder -->
    <div id="footer-placeholder"></div>

    <!-- JavaScript -->
    <script src="../assets/script.js"></script>
</body>
</html> 